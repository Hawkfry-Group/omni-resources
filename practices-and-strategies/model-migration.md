# Model Migration Strategy for Omni

## Scenario
You need to migrate your Omni model and content to a new data warehouse or schema, but your table names, columns, and data types remain the same. Only the schema/database paths have changed (e.g., moving from `old_schema.table` to `new_schema.table`).

This guide provides a quick, practical approach for this scenario using Omni's APIs and features.

---
Overall strategy here is to leave the existing model and content alone, so you have a fall back and a way to test insights remain unchanged. We do this by creating a new connection and model, copying content over to it using the API and then updating references using content validator.

## Steps

### 1. Create a New Connection
- In Omni, set up a new connection pointing to your new data warehouse or schema.
- Ensure the new connection has the correct default schema/database settings to match your new environment.

### 2. Migrate the Model
- Use the **Migrate Model API** to copy your existing model to a new model based on the new connection.
- If your model uses a default schema, and the new connection is set up with the same default, you may not need to update any table references.
- If not, update the schema/database references in the new model to match the new naming convention.
- Copy over the relationships file, and update the references
- Copy over view files contents where you have made changes outside the schema (switch to model view to see this)

### 3. Migrate Content (Dashboards, Workbooks, etc.)
- Use Omni's **Content Migration APIs** to copy dashboards, workbooks, and other content to point to the new model.
- This ensures all your content uses the new data source without manual recreation.
- **Example Script**: See `@document_migration.py` in the templates directory for a ready-to-use script to automate dashboard and workbook migration to a new model. Assumes you already have a list of document IDs.
- **Fix Broken Content References**: You have three options:
   - Use the content validator to fix broken references.
   - Use the `renamed_from` parameter in the new view file to reference the old view name.
   - Use the `aliases` parameter in the new view file to reference the old view name.
- Update any hardcoded URLs in the model which refernce the old dashboard IDs

### 4. Test Migration with Sample Content
- Before migrating all content, copy over a small set of dashboards or workbooks to the new model.
- Validate that these dashboards work as expected and update any broken references.
- This helps identify issues early and ensures a smoother full migration.

---

## Alternative Approach: Refreshing the Model on the New Schema

Instead of creating a new model and migrating content, you can keep the same content and model, but refresh the model onto the new schema. This approach is more manual and has some risks, but it keeps content IDs unchanged.

### Workflow
1. **Edit the Connection**: Point the existing connection to the new service account and catalog/schemas. Note: The model and all content using it will immediately show errors.
2. **View File Management**:
   - All original view files will be moved above the schema folder in the IDE when the connection is modified.
   - Change the `included_schemas`/`included_views` parameters to reference the new project/schema (e.g., `schema_new.prod_analytics`). The original files will disappear from the model as they are no longer included.
   - Copy/paste the contents of the old view files (now above the schema folder) into the new view files generated by the connection change. Do not rename view files in `included_views` until all content has been copied over.
3. **Fix Broken Content References**: You have three options:
   - Use the content validator to fix broken references (least ideal if you have a lot of content already pointing to this model).
   - Use the `renamed_from` parameter in the new view file to reference the old view name.
   - Use the `aliases` parameter in the new view file to reference the old view name.

### Pros and Cons
- **Pros**:
  - Content IDs remain the same (no need to update links/bookmarks).
- **Cons**:
  - Breaking production content.
  - Hard to rollback mistakes, as content references are not git controlled.
  - More manual and error-prone process.

---

## References
- [Omni Content Migration Guide](https://docs.omni.co/docs/finding-content/migrate-content)
- [Model Management in Omni](https://docs.omni.co/docs/modeling/model-management)

---

